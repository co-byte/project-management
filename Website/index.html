<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>PERT Gantt Chart</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    // Load Google Charts API
    google.charts.load('current', { 'packages': ['gantt'] });

    function drawChartFromJson(filePath, chartId) {
      // Fetch the JSON data generated by your TypeScript script
      fetch(filePath)
        .then(response => response.json())
        .then(data => {
          scheduleData = data.schedule;
          totalCost = data.totalCost;

          const chartData = new google.visualization.DataTable();
          chartData.addColumn('string', 'Task ID');
          chartData.addColumn('string', 'Task Name');
          chartData.addColumn('string', 'Resource');
          chartData.addColumn('date', 'Start Date');
          chartData.addColumn('date', 'End Date');
          chartData.addColumn('number', 'Duration');
          chartData.addColumn('number', 'Percent Complete');
          chartData.addColumn('string', 'Dependencies');

          // Add rows to the DataTable
          scheduleData.forEach(task => {
            // Convert schedule data to chart-friendly format
            chartData.addRow([
              task.id,                            // Task ID
              task.activity,                       // Task Name
              '*'.repeat(task.level_of_revealingness || 0),        // Resource (Optional)
              new Date(2024, 0, task.start),      // Start Date (dummy start date)
              new Date(2024, 0, task.end),        // End Date (dummy start date)
              task.end - task.start,              // Duration (in days)
              100,                                // Percent Complete
              task.dependencies.join(', ')        // Dependencies (Task IDs)
            ]);
          });

          // Create the chart
          const chart = new google.visualization.Gantt(document.getElementById(chartId));

          const newHeight = scheduleData.length * 42 + 100;

          // Draw the chart with the data
          chart.draw(chartData, {
            height: newHeight,
            width: '100%'
          });

          // Display the total cost in the HTML
          const costElement = document.getElementById('total_cost_' + chartId);
          costElement.textContent = `Total Cost: $${totalCost.toFixed(2)}`;
        })
        .catch(error => console.error('Error loading the schedule data:', error));
    }

    google.charts.setOnLoadCallback(() => {
      drawChartFromJson('./data/schedule_pert.json', 'gantt_chart_pert');
      drawChartFromJson('./data/schedule_kart.json', 'gantt_chart_kart');
    });

  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
    }

    h1 {
      text-align: center;
    }

    .gantt_chart {
      width: 100%;
      margin-top: 5%;
      margin-bottom: 0;
      padding: 0;
    }

    .totalCost {
      text-align: center;
      font-size: 1.5em;
      margin-bottom: 10%;
    }
  </style>
</head>

<body>
  <h1>PERT Gantt Chart</h1>
  <div id="gantt_chart_pert" class="gantt_chart"></div>
  <div id="total_cost_gantt_chart_pert" class="totalCost"></div>

  <h1>KART Gantt Chart</h1>
  <div id="gantt_chart_kart" class="gantt_chart"></div>
  <div id="total_cost_gantt_chart_kart" class="totalCost"></div>
</body>

</html>
